<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bon de Livraison - Commande #{{ commande.id }}</title>
    <style>
        /* --- On reprend le style général de vos devis/factures pour la cohérence --- */
        @import url('https://fonts.googleapis.com/css2?family=Arial&family=Dancing+Script&display=swap');
        html, body { height: 100%; margin: 0; padding: 0; }
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f0f0f0; font-size: 10pt; }
        .page {width: 18cm; height: 85%; margin: 20 auto; padding: 10mm; box-sizing: border-box; display:flex; flex-direction:column; position:relative; }
        .header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid black; padding-bottom: 8px; margin-bottom: 12px; gap:12px; }
        .company-info { flex:1 1 auto; }
        .company-info p { margin: 0; line-height: 1.25; }
        .company-name { font-weight: bold; color: #4A90E2; }
        .logo-placeholder { width: 120px; height: 70px; color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-size: 9pt; flex:0 0 auto; position:absolute; top:6mm; right:8mm; }
        .date { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-size: 9pt; flex:0 0 auto; position:absolute; top:48mm; right:12mm; width: 20%; }    
        .header { padding-right: 140px; }
        .doc-title-section { margin-bottom: 8px; }
        .doc-title { font-size: 16pt; font-weight: bold; text-decoration: underline; margin: 0 0 10px 0; }
        .doc-meta { display: flex; justify-content: space-between; flex-direction:"row";}
        .doc-id, .doc-date { border: 1px solid black; padding: 4px 6px; }
        .doc-id table, .doc-date table { border-collapse: collapse; }
        .doc-id td, .doc-date td { padding: 2px 4px; }
        .doc-date { min-width: 140px; }
        .client-info { width: 48%; margin-bottom: 15px; border: 1px solid black; margin-top:15px}
        .client-info table { width: 100%; border-collapse: collapse; }
        .client-info td { border: 1px solid black; padding: 4px 6px; }
        .client-info td:first-child { font-weight: bold; width: 90px; }
        /* Style spécifique pour la table du BL (plus simple) */
        .items-table { width: 100%; border-collapse: collapse; margin-bottom: 6px; font-size: 9pt; table-layout: fixed; word-wrap: break-word; }
        .items-table thead { background-color: #e0e0e0; }
        .items-table th, .items-table td { border: 1px solid black; padding: 6px 6px; text-align: left; }
        .items-table .col-qtt { text-align: right; width: 120px; }
        .items-table tbody tr { height: 30px; }
        .placeholder { color: #888; }
        /* Style pour la section de signature */
        .final-footer { margin-top: auto; padding-top: 40px; display: flex; justify-content: space-between; align-items: flex-end; }
        .signature-box { border: 1px solid #333; padding: 10px; margin-top: 40px; height: 100px; width: 100%; }
        .signature-section { text-align: center; }
        .signature-placeholder { font-family: 'Dancing Script', cursive; font-size: 24pt; height: 60px; }
        .signature-section p { margin: 5px 0 0 0; }
        .items-table tfoot td { font-weight: bold; background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="page">
        <!-- HEADER (Identique aux autres documents) -->
        <div class="header">
            <div class="company-info">
                <p class="company-name">FOREVER MG</p>
                <p>ANDAFIAVARATRA</p>
                <p>034 03 767 69 - 038 25 722 47</p>
                <p>NIF: 3000736044</p>
                <p>STAT: 90000 11 2012 0 00411</p>
            </div>
            <div style="display:flex;align-items:flex-start;justify-content:flex-end;width:34%;">
                <div style="display:flex;align-items:flex-start;"> 
                    <div class="logo-placeholder" style="align-self:flex-start;">
                        {# Vous pouvez ajouter une variable 'logo' dans votre action de contrôleur si besoin #}
                        <img src="{{ logo }}" alt="Logo Forever" style="width:100px;">
                    </div>
                </div>
            </div>
        </div>

        <!-- TITRE DU BON DE LIVRAISON -->
        <div class="doc-title-section">
            <h1 class="doc-title">BON DE LIVRAISON</h1>
            <div class="doc-meta" style="display:flex; gap: 10px; flex-direction:row; width:40%;">
                <div class="doc-id" style="border:0.01px solid #000000b4;padding:6px;">
                    <table>
                        <tr>
                            <td style="font-weight:bold;padding-right:6px;">N° Bon de livraison:</td>
                            <td>{{ '%05d'|format(bonDeLivraison.id) }}</td>
                        </tr>

                        <!-- On vérifie si le champ 'numeroBonCommande' de la commande est rempli -->
                        {% if commande.numeroBonCommande %}
                        <tr>
                            <td style="font-weight:bold;padding-right:6px;">N° Bon de commande :</td>
                            <td>BC-{{ '%05d'|format(commande.numeroBonCommande) }}</td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
                <div class="date" style="border:0.01px solid #000000b4;padding:6px; height:38px;">
                    <table>
                        <tr>
                            <td style="font-weight:bold;padding-right:6px;">Date :</td>
                            <td>{{ "now"|date('d/m/Y') }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- INFOS CLIENT ET LIVRAISON -->
        <div class="client-info">
            <table>
                <tr><td>CLIENT :</td><td>{{ commande.client.nom|default('#REF!') }}</td></tr>
                <tr><td>ADRESSE :</td><td>{{ commande.lieuDeLivraison|default(commande.client.adresse)|default('#REF!') }}</td></tr>
                <tr><td>CONTACT :</td><td>{{ commande.client.telephone|default('#REF!') }}</td></tr>
                {% if commande.nomLivreur %}
                <tr><td>LIVREUR :</td><td>{{ commande.nomLivreur }}</td></tr>
                {% endif %}
            </table>
        </div>

        <!-- TABLEAU DES PRODUITS (Sans prix) -->
        <table class="items-table">
            <thead>
                <tr>
                    <th class="col-designation">DESIGNATION</th>
                    <th class="col-qtt">QUANTITÉ</th>
                </tr>
            </thead>
            <tbody>
                {# ✅ ÉTAPE 1: On initialise la variable pour le total #}
                {% set totalQuantite = 0 %}

                {% for ligne in commande.commandeProduits %}
                    <tr>
                        <td>{{ ligne.produit.nom|default('Produit non spécifié') }}</td>
                        <td class="col-qtt">{{ ligne.quantite }}</td>
                    </tr>
                    {# On ajoute la quantité de la ligne au total #}
                    {% set totalQuantite = totalQuantite + ligne.quantite %}
                {% else %}
                    <tr><td colspan="2" class="placeholder">Aucun produit listé.</td></tr>
                {% endfor %}
            </tbody>
            
            {# ✅ ÉTAPE 2: On ajoute un pied de page au tableau pour afficher le total #}
            <tfoot>
                <tr>
                    <td class="col-designation"><strong>Total des articles</strong></td>
                    <td class="col-qtt"><strong>{{ totalQuantite }}</strong></td>
                </tr>
            </tfoot>
        </table>

        <!-- PIED DE PAGE AVEC ZONE DE SIGNATURE -->
        <div class="final-footer">
            <div class="signature-box">
                <p>Reçu en bon état, le : ________ / ________ / ____________</p>
                <br>
                <p>Nom et Signature du Client (précédé de "Lu et approuvé") :</p>
            </div>
        </div>
    </div>
</body>
</html>